-- Script was generated by Devart dbForge Studio for MySQL, Version 6.0.128.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 20/09/2018 12:05:38 p. m.
-- Server version: 5.5.5-10.1.31-MariaDB
-- Client version: 4.1

--
-- Definition for database bd_moteles
--
DROP DATABASE IF EXISTS bd_moteles;
CREATE DATABASE IF NOT EXISTS bd_moteles
	CHARACTER SET utf8
	COLLATE utf8_spanish_ci;

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

-- 
-- Set default database
--
USE bd_moteles;

--
-- Definition for table listasprecioshabitaciones
--
CREATE TABLE IF NOT EXISTS listasprecioshabitaciones (
  CodLista VARCHAR(3) DEFAULT NULL,
  NombreLista VARCHAR(30) DEFAULT NULL,
  UNIQUE INDEX UK_listasprecioshabitaciones_C (CodLista)
)
ENGINE = INNODB
AVG_ROW_LENGTH = 8192
CHARACTER SET utf8
COLLATE utf8_spanish_ci;

--
-- Definition for table ocupacion
--
CREATE TABLE IF NOT EXISTS ocupacion (
  IdOcupacion INT(11) NOT NULL AUTO_INCREMENT,
  CodHabitacion INT(11) NOT NULL,
  Estado VARCHAR(10) DEFAULT 'OCUPADO',
  Horas INT(11) NOT NULL,
  Extras INT(11) DEFAULT NULL,
  ValorServicio DOUBLE NOT NULL,
  ValorExtra DOUBLE DEFAULT NULL,
  ValorConsumos DOUBLE DEFAULT NULL,
  ValorTotal DOUBLE DEFAULT NULL,
  PRIMARY KEY (IdOcupacion)
)
ENGINE = INNODB
AUTO_INCREMENT = 1
CHARACTER SET utf8
COLLATE utf8_spanish_ci
COMMENT = 'Tabla donde se guarda la ocupacion en vivo';

--
-- Definition for table servicioshabitaciones
--
CREATE TABLE IF NOT EXISTS servicioshabitaciones (
  CodServicioHab VARCHAR(3) DEFAULT NULL,
  Horas INT(11) DEFAULT NULL,
  UNIQUE INDEX UK_servicioshabitaciones_CodSe (CodServicioHab)
)
ENGINE = INNODB
AVG_ROW_LENGTH = 4096
CHARACTER SET utf8
COLLATE utf8_spanish_ci;

--
-- Definition for table tiposhabitaciones
--
CREATE TABLE IF NOT EXISTS tiposhabitaciones (
  CodTipoHab VARCHAR(3) NOT NULL,
  NomTipo VARCHAR(255) DEFAULT NULL,
  Caracteristicas VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (CodTipoHab)
)
ENGINE = INNODB
AVG_ROW_LENGTH = 8192
CHARACTER SET utf8
COLLATE utf8_spanish_ci;

--
-- Definition for table habitaciones
--
CREATE TABLE IF NOT EXISTS habitaciones (
  CodHabitacion VARCHAR(3) NOT NULL,
  Numero VARCHAR(4) NOT NULL,
  CodTipoHab VARCHAR(3) NOT NULL,
  Estado VARCHAR(15) NOT NULL DEFAULT 'Activo',
  PRIMARY KEY (CodHabitacion),
  CONSTRAINT `habitaciones-tipohabitaciones` FOREIGN KEY (CodTipoHab)
    REFERENCES tiposhabitaciones(CodTipoHab) ON DELETE RESTRICT ON UPDATE RESTRICT
)
ENGINE = INNODB
AVG_ROW_LENGTH = 2730
CHARACTER SET utf8
COLLATE utf8_spanish_ci;

--
-- Definition for table precioshabitaciones
--
CREATE TABLE IF NOT EXISTS precioshabitaciones (
  CodLista VARCHAR(3) NOT NULL,
  CodTipoHab VARCHAR(3) DEFAULT NULL,
  CodServicioHab VARCHAR(3) DEFAULT NULL,
  ValorServicio DOUBLE DEFAULT NULL,
  CONSTRAINT `listaprecios-precios` FOREIGN KEY (CodLista)
    REFERENCES listasprecioshabitaciones(CodLista) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `precios-servicios` FOREIGN KEY (CodServicioHab)
    REFERENCES servicioshabitaciones(CodServicioHab) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `precios-tipohabitaciones` FOREIGN KEY (CodTipoHab)
    REFERENCES tiposhabitaciones(CodTipoHab) ON DELETE RESTRICT ON UPDATE RESTRICT
)
ENGINE = INNODB
AVG_ROW_LENGTH = 4096
CHARACTER SET utf8
COLLATE utf8_spanish_ci;

--
-- Definition for view vistahabitaciones
--
CREATE OR REPLACE 
	DEFINER = 'root'@'localhost'
VIEW vistahabitaciones
AS
	select `h`.`Numero` AS `Numero`,`t`.`NomTipo` AS `Nombre`,`h`.`Estado` AS `Estado` from (`habitaciones` `h` join `tiposhabitaciones` `t`) where (`h`.`CodTipoHab` = `t`.`CodTipoHab`);

-- 
-- Dumping data for table listasprecioshabitaciones
--
INSERT INTO listasprecioshabitaciones VALUES
('1', 'SEMANA'),
('2', 'FIN DE SEMANA');

-- 
-- Dumping data for table ocupacion
--

-- Table bd_moteles.ocupacion does not contain any data (it is empty)

-- 
-- Dumping data for table servicioshabitaciones
--
INSERT INTO servicioshabitaciones VALUES
('1', 3),
('2', 6),
('3', 12);

-- 
-- Dumping data for table tiposhabitaciones
--
INSERT INTO tiposhabitaciones VALUES
('1', 'SENCILLA', NULL),
('2', 'JUNIOR', NULL);

-- 
-- Dumping data for table habitaciones
--
INSERT INTO habitaciones VALUES
('1', '201', '1', 'Activo'),
('10', '307', '2', 'Inactiva'),
('11', '308', '1', 'Activo'),
('2', '202', '1', 'Activo'),
('3', '203', '2', 'Activo'),
('4', '301', '1', 'Activo'),
('5', '302', '1', 'Activo'),
('6', '303', '2', 'Activo'),
('7', '304', '1', 'Activo'),
('8', '305', '1', 'Activo'),
('9', '306', '1', 'Activo');

-- 
-- Dumping data for table precioshabitaciones
--
INSERT INTO precioshabitaciones VALUES
('1', '1', '1', 30000),
('1', '1', '2', 50000),
('1', '1', '3', 60000),
('2', '1', '1', 50000);

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;